# 一个使用Git的实际例子

某天，小杨开始一个新的项目，所以在远端服务器（小杨使用的是GitHub）新建一个仓库叫MyProject，并开始开发：

```shell
$ git clone https://github.com/DiaoStudio/MyProject.git
```

小杨执行了`clone`命令将仓库“拖”到本地。小杨是一个熟练的Git使用者，他懂得合理的分支管理知识，所以首先他添加了一些必要的文件，并将本地的master分支合并到远端：

```shell
$ git status
$ git add .
$ git commit
$ git push origin master
```

小杨用`status`命令查看了一下修改情况，胸有成竹地执行了`add .`将所有修改添加到待提交索引，并麻利地敲下`commit`命令提交修改并打包成一个版本，最后执行`push`命令将本地修改提交到远端服务器，并将在远端建立一个名为master的分支。

----

小杨完成了前置工作，开始正式开发：

```shell
$ git checkout -b develop
$ git add .
$ git commit
$ git push origin develop
```

小杨提交了一个跟`master`一模一样的分支`develop`到远程，这是干什么用的呢？后面有说明，我们先来看看小杨又干了点什么。

```shell
$ git checkout -b feature/add-new-files
$ git branch
* feature/add-new-files
  master
```

前面已经提到，小杨已经不是第一次使用Git了，他的做法很麻溜儿，直接使用`checkout -b`命令新建了一个分支并切换过去，完全不需要`branch`新分支再`checkout`过去。但是我们的小杨不仅是一个技能熟练的程序员，也是一个谨慎的程序员，他执行了`branch`命令来查看一下是否已经切换到指定的分支，看到确实已经切换过去，小杨自信地点了一下头。

大伙儿发现小杨新建分支的命名很奇怪：
* 仓库里有`master`分支，还有一个`develop`分支。
* 仓库里其他分支有些是以`feature/`开头，有些是用`refactor/`开头，有些使用`bugfix/`开头。

刚开始小杨的团队很不解，于是小杨告诉他们，这样做的好处都有啥：
* 小杨在远端Github上指定了`master`分支保护，只有制定的人能合并`master`分支，这样保证了系统的高可用性，不会因为莫名其妙的路人提交使得整个系统搀入bug。
* 于是小杨建立了一个`develop`分支来做`master`分支的预备合并分支，每个人都可以提`pull request`来要求管理员来合并自己的分支到`develop`分支，换句话说`develop`分支就是`master`分支的前置版本。
* 很多Git实现用URL来表示分支，使用类似`feature/`开头的分支名可以很直观的知道这个提交的分支的主要干了啥。

大伙儿纷纷说小杨这个习惯好，于是修改了Git使用文档，并开始延用小杨的做法，看到自己的做法被肯定，小杨欣慰的笑了。

----

经过一系列开发，小杨完成了一个阶段的工作，并决定去喝一瓶他最喜欢的可口可乐，于是他习惯性地开始着手将本地内容提交到远端，合理提交修改是一个好习惯。

这时候要提一下小杨的好朋友小徐，他也是一个程序员，但是他也许运气不好，也许粗心大意，曾经在开发时，对文件修改之后，想一次性将所有任务提交，拖了好久，结果电脑硬盘坏了，导致之前的开发完全白做，这时候小徐想到，应该早早将修改提交到远端服务器，但是程序还是要写的，所以他只能开始重复性的工作，流下了悔恨的泪水。

但是小徐不是一个知错就改的人，有一次他又习惯性的拖了好久不提交代码，到最终提交的时候，和团队中其他人发生了大量冲突，于是大伙只能坐下来着手解决这些冲突，因为增加了大伙的工作，大伙逼着小徐请客吃饭，最后看着账单，这时候小徐想到，应该早早提交修改到远端服务器，这样可以在冲突发生之前解决问题，流下了悔恨的泪水。

上面提到了小徐的问题，这是一个提交频率的问题，在团队开发中很重要，提交代码不宜过频，也不宜长时间不提交，这一点需要实际情况实际把握。

顺便说一下，小徐最后在小杨的教育下改正了这个陋习。

说回小杨，他的目标是将本地的修改提交到远端，于是他打出：

```shell
$ git add .
$ git commit
$ git push origin feature/add-new-files
```

跟之前一样，小杨提交了所有修改，并将这些修改`push`到了远端服务器，远端服务器发现没有叫`feature/add-new-files`的分支，于是好心地新建了一个叫这个名字的分支。

----

小杨登录Github，提出一个`pull request`来要求管理员合并`feature/add-new-files`分支到`develop`，在web界面上，小杨记录了修改信息，并assign给了主管，一个**PR**就这么提出来了。

当然主管是日理万机的人，小杨虽然跟大多数程序员一样技术全面、心地善良，但是主管还是不会第一时间来查看小杨的PR。不过这也没事儿，Git本身就允许这样做，甚至可以说提倡这样做，在不能完全确定提交的安全性的时候，小心合并是很重要的，不过前面提到过，小杨是个谨慎的程序员，所以他另外建立了`develop`分支来进一步预防bug进入正式版本，这也是建立一个类似`develop`分支的好处。

因为小杨是一个技术全面的人，主管十分信任他，看也不看就同意了PR，于是`feature/add-new-files`分支就这么合并到了`develop`分支。

----

> 悲剧源于不小心。
>         ----by 小杨

然而人无完人，小杨发现自己在之前的代码中混入了一个不易察觉的bug，于是他开始着手修复这个bug：

```shell
$ git checkout develop
$ git pull origin develop
$ git checkout -b bugfix/remove-small-bug
```

小杨切换到本地的`develop`分支，然后`pull`了远程的`develop`分支，并合并到本地的`develop`分支，这时候，本地的`develop`分支已经是最新的`develop`分支了。一切就绪，小杨从`develop`分支中`checkout`一个新分支`bugfix/remove-small-bug`，并开始了修复工作。

经过一个小时的努力，bug被修复了，小杨就敲出：

```shell
$ git add .
$ git commit
$ git push origin bugfix/remove-small-bug
```

跟之前一样，提交分支到远端，再提PR合并。

最终，主管还是看也不看就合并了PR，一切都出于对小杨的信任，这是对小杨技术最大的肯定。

----

这就是小杨使用Git的一个实际情况。